-- version 2019 03 06

DROP TABLE DWH_ADMIN_DOCUMENT_ORIGIN CASCADE CONSTRAINTS;
ALTER TABLE DWH_COHORT DROP PRIMARY KEY CASCADE;
DROP TABLE DWH_COHORT CASCADE CONSTRAINTS;
DROP TABLE DWH_COHORT_RESULT CASCADE CONSTRAINTS;
ALTER TABLE DWH_COHORT_RESULT_COMMENT DROP PRIMARY KEY CASCADE;
DROP TABLE DWH_COHORT_RESULT_COMMENT CASCADE CONSTRAINTS;
DROP TABLE DWH_COHORT_USER_RIGHT CASCADE CONSTRAINTS;
ALTER TABLE DWH_DATA DROP PRIMARY KEY CASCADE;
DROP TABLE DWH_DATA CASCADE CONSTRAINTS;
ALTER TABLE DWH_DATAMART DROP PRIMARY KEY CASCADE;
DROP TABLE DWH_DATAMART CASCADE CONSTRAINTS;
DROP TABLE DWH_DATAMART_DOC_ORIGIN CASCADE CONSTRAINTS;
DROP TABLE DWH_DATAMART_RESULT CASCADE CONSTRAINTS;
DROP TABLE DWH_DATAMART_USER_RIGHT CASCADE CONSTRAINTS;
DROP TABLE DWH_DOCUMENT CASCADE CONSTRAINTS;
DROP TABLE DWH_DOCUMENT_A_TRAITER CASCADE CONSTRAINTS;
ALTER TABLE DWH_ECRF DROP PRIMARY KEY CASCADE;
DROP TABLE DWH_ECRF CASCADE CONSTRAINTS;
DROP TABLE DWH_ECRF_ANSWER CASCADE CONSTRAINTS;
ALTER TABLE DWH_ECRF_ITEM DROP PRIMARY KEY CASCADE;
DROP TABLE DWH_ECRF_ITEM CASCADE CONSTRAINTS;
DROP TABLE DWH_ECRF_USER_RIGHT CASCADE CONSTRAINTS;
DROP TABLE DWH_ENRSEM CASCADE CONSTRAINTS;
DROP TABLE DWH_ETL_PROCESS CASCADE CONSTRAINTS;
DROP TABLE DWH_ETL_SCRIPT CASCADE CONSTRAINTS;
DROP TABLE DWH_ETL_THESAURUS_ENRSEM CASCADE CONSTRAINTS;
DROP TABLE DWH_ETL_THESAURUS_GENE CASCADE CONSTRAINTS;
DROP TABLE DWH_EXPORT_DATA CASCADE CONSTRAINTS;
ALTER TABLE DWH_FILE DROP PRIMARY KEY CASCADE;
DROP TABLE DWH_FILE CASCADE CONSTRAINTS;
DROP TABLE DWH_INFO_AGGREGATE CASCADE CONSTRAINTS;
DROP TABLE DWH_INFO_ENRSEM CASCADE CONSTRAINTS;
DROP TABLE DWH_INFO_LOAD CASCADE CONSTRAINTS;
DROP TABLE DWH_LOG_DOCUMENT CASCADE CONSTRAINTS;
DROP TABLE DWH_LOG_PAGE CASCADE CONSTRAINTS;
DROP TABLE DWH_LOG_PATIENT CASCADE CONSTRAINTS;
DROP TABLE DWH_LOG_QUERY CASCADE CONSTRAINTS;
DROP TABLE DWH_NOTIFICATION CASCADE CONSTRAINTS;
DROP TABLE DWH_PATIENT CASCADE CONSTRAINTS;
DROP TABLE DWH_PATIENT_DEPARTMENT CASCADE CONSTRAINTS;
DROP TABLE DWH_PATIENT_IPPHIST CASCADE CONSTRAINTS;
DROP TABLE DWH_PATIENT_MVT CASCADE CONSTRAINTS;
DROP TABLE DWH_PATIENT_OPPOSITION CASCADE CONSTRAINTS;
DROP TABLE DWH_PATIENT_REL CASCADE CONSTRAINTS;
DROP TABLE DWH_PATIENT_STAT CASCADE CONSTRAINTS;
DROP TABLE DWH_PATIENT_STAY CASCADE CONSTRAINTS;
DROP TABLE DWH_PROCESS CASCADE CONSTRAINTS;
DROP TABLE DWH_PROCESS_PATIENT CASCADE CONSTRAINTS;
DROP TABLE DWH_PROFILE_DOCUMENT_ORIGIN CASCADE CONSTRAINTS;
DROP TABLE DWH_PROFILE_RIGHT CASCADE CONSTRAINTS;
ALTER TABLE DWH_QUERY  DROP PRIMARY KEY CASCADE;
DROP TABLE DWH_QUERY CASCADE CONSTRAINTS;
DROP TABLE DWH_QUERY_RESULT CASCADE CONSTRAINTS;
DROP TABLE DWH_REQUEST_ACCESS CASCADE CONSTRAINTS;
DROP TABLE DWH_REQUEST_ACCESS_PATIENT CASCADE CONSTRAINTS;
DROP TABLE DWH_TEXT CASCADE CONSTRAINTS;
DROP TABLE DWH_THESAURUS_CITY CASCADE CONSTRAINTS;
DROP TABLE DWH_THESAURUS_CORRORTHO CASCADE CONSTRAINTS;
DROP TABLE DWH_THESAURUS_COUNTRY CASCADE CONSTRAINTS;
ALTER TABLE DWH_THESAURUS_DATA  DROP PRIMARY KEY CASCADE;
DROP TABLE DWH_THESAURUS_DATA CASCADE CONSTRAINTS;
DROP TABLE DWH_THESAURUS_DATA_GRAPH CASCADE CONSTRAINTS;
ALTER TABLE DWH_THESAURUS_DEPARTMENT  DROP PRIMARY KEY CASCADE;
DROP TABLE DWH_THESAURUS_DEPARTMENT CASCADE CONSTRAINTS;
DROP TABLE DWH_THESAURUS_ENRSEM CASCADE CONSTRAINTS;
DROP TABLE DWH_THESAURUS_ENRSEM_GRAPH CASCADE CONSTRAINTS;
DROP TABLE DWH_THESAURUS_PUBMED_GENE CASCADE CONSTRAINTS;
DROP TABLE DWH_THESAURUS_PUBMED_GENE2GO CASCADE CONSTRAINTS;
DROP TABLE DWH_THESAURUS_TAL CASCADE CONSTRAINTS;
DROP TABLE DWH_THESAURUS_TAL_CHEMIN CASCADE CONSTRAINTS;
DROP TABLE DWH_THESAURUS_TYPESEMANTIC CASCADE CONSTRAINTS;
DROP TABLE DWH_THESAURUS_UNIT CASCADE CONSTRAINTS;
DROP TABLE DWH_TMP_PRERESULT CASCADE CONSTRAINTS;
DROP TABLE DWH_TMP_QUERY CASCADE CONSTRAINTS;
DROP TABLE DWH_TMP_RESULT CASCADE CONSTRAINTS;
DROP TABLE DWH_TOOL CASCADE CONSTRAINTS;
ALTER TABLE DWH_USER  DROP PRIMARY KEY CASCADE;
DROP TABLE DWH_USER CASCADE CONSTRAINTS;
DROP TABLE DWH_USER_CONNEXION CASCADE CONSTRAINTS;
DROP TABLE DWH_USER_PROFILE CASCADE CONSTRAINTS;
DROP TABLE DWH_USER_ONLINE CASCADE CONSTRAINTS;
DROP TABLE DWH_USER_DEPARTMENT CASCADE CONSTRAINTS;


CREATE TABLE DWH_ADMIN_DOCUMENT_ORIGIN
(
  DOCUMENT_ORIGIN_CODE  VARCHAR2(50 CHAR),
  DOCUMENT_ORIGIN_STR   VARCHAR2(200 CHAR)
)
TABLESPACE TS_DWH
LOGGING 
MONITORING;


CREATE TABLE DWH_COHORT
(
  COHORT_NUM          INTEGER,
  TITLE_COHORT        VARCHAR2(300 CHAR),
  DESCRIPTION_COHORT  VARCHAR2(4000 CHAR),
  COHORT_DATE         DATE,
  USER_NUM            INTEGER,
  DATAMART_NUM        INTEGER,
  PRIMARY KEY
  (COHORT_NUM)
)
TABLESPACE TS_DWH
LOGGING 
MONITORING;



CREATE TABLE DWH_COHORT_RESULT
(
  COHORT_NUM    INTEGER,
  STATUS        INTEGER,
  ADD_DATE      DATE,
  USER_NUM_ADD  INTEGER,
  PATIENT_NUM   INTEGER,
  QUERY_NUM     INTEGER,
  FOREIGN KEY (COHORT_NUM) 
  REFERENCES DWH_COHORT (COHORT_NUM)
  ON DELETE CASCADE
)
TABLESPACE TS_DWH
LOGGING 
MONITORING;



CREATE TABLE DWH_COHORT_RESULT_COMMENT
(
  COHORT_RESULT_COMMENT_NUM  INTEGER,
  COHORT_NUM                 INTEGER,
  PATIENT_NUM                INTEGER,
  COMMENT_DATE               DATE,
  USER_NUM                   INTEGER,
  COMMENTARY                 VARCHAR2(4000 CHAR),
  PRIMARY KEY
  (COHORT_RESULT_COMMENT_NUM),
  FOREIGN KEY (COHORT_NUM) 
  REFERENCES DWH_COHORT (COHORT_NUM)
  ON DELETE CASCADE
)
TABLESPACE TS_DWH
LOGGING 
MONITORING;



CREATE TABLE DWH_COHORT_USER_RIGHT
(
  COHORT_NUM  INTEGER,
  USER_NUM    INTEGER,
  RIGHT       VARCHAR2(40 CHAR),
  FOREIGN KEY (COHORT_NUM) 
  REFERENCES DWH_COHORT (COHORT_NUM)
  ON DELETE CASCADE
)
TABLESPACE TS_DWH
LOGGING 
MONITORING;



CREATE TABLE DWH_DATA
(
  DATA_NUM              INTEGER,
  DOCUMENT_NUM          INTEGER,
  THESAURUS_CODE        VARCHAR2(30 CHAR),
  VAL_NUMERIC           FLOAT(126),
  VAL_TEXT              VARCHAR2(500 CHAR),
  DOCUMENT_DATE         DATE,
  LOWER_BOUND           FLOAT(126),
  UPPER_BOUND           FLOAT(126),
  ENCOUNTER_NUM         VARCHAR2(30 CHAR),
  DOCUMENT_ORIGIN_CODE  VARCHAR2(30 CHAR),
  AGE_PATIENT           FLOAT(126),
  DEPARTMENT_NUM        INTEGER,
  PATIENT_NUM           INTEGER,
  UPLOAD_ID             INTEGER,
  THESAURUS_DATA_NUM    INTEGER,
  PRIMARY KEY
  (DATA_NUM)
)
TABLESPACE TS_DWH
LOGGING 
MONITORING;



CREATE TABLE DWH_DATAMART
(
  DATAMART_NUM          INTEGER,
  TITLE_DATAMART        VARCHAR2(300 CHAR),
  DATAMART_DATE         DATE,
  DATE_START            DATE,
  END_DATE              DATE,
  DESCRIPTION_DATAMART  VARCHAR2(4000 CHAR),
  TEMPORARY_STATUS      INTEGER,
  DATAMART_NUM_ORIGIN   INTEGER,
  PRIMARY KEY
  (DATAMART_NUM)
)
TABLESPACE TS_DWH
LOGGING 
MONITORING;



CREATE TABLE DWH_DATAMART_DOC_ORIGIN
(
  DATAMART_NUM          INTEGER,
  DOCUMENT_ORIGIN_CODE  VARCHAR2(40 CHAR),
  FOREIGN KEY (DATAMART_NUM) 
  REFERENCES DWH_DATAMART (DATAMART_NUM)
  ON DELETE CASCADE
)
TABLESPACE TS_DWH
LOGGING 
MONITORING;



CREATE TABLE DWH_DATAMART_RESULT
(
  DATAMART_NUM  INTEGER,
  PATIENT_NUM   INTEGER,
  FOREIGN KEY (DATAMART_NUM) 
  REFERENCES DWH_DATAMART (DATAMART_NUM)
  ON DELETE CASCADE
)
TABLESPACE TS_DWH
LOGGING 
MONITORING;



CREATE TABLE DWH_DATAMART_USER_RIGHT
(
  DATAMART_NUM  INTEGER,
  USER_NUM      INTEGER,
  RIGHT         VARCHAR2(40 CHAR),
  FOREIGN KEY (DATAMART_NUM) 
  REFERENCES DWH_DATAMART (DATAMART_NUM)
  ON DELETE CASCADE
)
TABLESPACE TS_DWH
LOGGING 
MONITORING;



CREATE TABLE DWH_DOCUMENT
(
  DOCUMENT_NUM              INTEGER,
  UPDATE_DATE               DATE,
  TITLE                     VARCHAR2(400 CHAR),
  DOCUMENT_ORIGIN_CODE      VARCHAR2(40 CHAR),
  DOCUMENT_DATE             DATE,
  ENCOUNTER_NUM             VARCHAR2(30 CHAR),
  UNIT_CODE                 VARCHAR2(30 CHAR),
  ID_DOC_SOURCE             VARCHAR2(300 CHAR),
  UF_EXEC_DROP              VARCHAR2(30 CHAR),
  DISPLAYED_TEXT            CLOB,
  AUTHOR                    VARCHAR2(200 CHAR),
  UM_DROP                   VARCHAR2(30 CHAR),
  EXTRACTCONCEPT_DONE_FLAG  INTEGER,
  ENRGENE_DONE_FLAG         INTEGER,
  DEPARTMENT_NUM            INTEGER,
  UNIT_NUM                  INTEGER,
  ENRICHTEXT_DONE_FLAG      INTEGER,
  PATIENT_NUM               INTEGER,
  DOCUMENT_TYPE             VARCHAR2(40 CHAR),
  UPLOAD_ID                 INTEGER,
  EXTRACTCONTEXT_DONE_FLAG  INTEGER
)
TABLESPACE TS_DWH
LOGGING 
MONITORING;



CREATE TABLE DWH_DOCUMENT_A_TRAITER
(
  DOCUMENT_NUM  INTEGER
)
TABLESPACE TS_DWH
LOGGING 
MONITORING;


CREATE TABLE DWH_ECRF
(
  ECRF_NUM          INTEGER,
  USER_NUM          INTEGER,
  TITLE_ECRF        VARCHAR2(4000 CHAR),
  DESCRIPTION_ECRF  VARCHAR2(4000 CHAR),
  ECRF_DATE         DATE,
  TOKEN_ECRF        VARCHAR2(200 CHAR),
  URL_ECRF            VARCHAR(400 CHAR),
  ECRF_START_DATE     DATE,
  ECRF_END_DATE       DATE, 
  ECRF_START_AGE      FLOAT,
  ECRF_END_AGE        FLOAT
  PRIMARY KEY
  (ECRF_NUM)
)
TABLESPACE TS_DWH
LOGGING 
MONITORING;


CREATE TABLE DWH_ECRF_ITEM
(
  ECRF_ITEM_NUM  INTEGER,
  ECRF_NUM       INTEGER,
  ITEM_STR       VARCHAR2(4000 CHAR),
  ITEM_TYPE      VARCHAR2(200 CHAR),
  ITEM_LIST      VARCHAR2(4000 CHAR),
  ITEM_NAME      VARCHAR2(200 CHAR),
  ITEM_CODES     VARCHAR2(4000 CHAR),
  REGEXP         VARCHAR2(500 CHAR),
  LOCAL_CODES    VARCHAR2(4000 CHAR),
  REGEXP_INDEX   VARCHAR2(10 CHAR),
  PERIOD         VARCHAR2(50 CHAR),
  ITEM_ORDER     INTEGER,
  PRIMARY KEY
  (ECRF_ITEM_NUM),
  FOREIGN KEY (ECRF_NUM) 
  REFERENCES DWH_ECRF (ECRF_NUM)
  ON DELETE CASCADE
)
TABLESPACE TS_DWH
LOGGING 
MONITORING;


CREATE TABLE DWH_ECRF_ANSWER
(
  ECRF_ITEM_NUM       INTEGER,
  ECRF_NUM            INTEGER,
  PATIENT_NUM         INTEGER,
  USER_NUM            INTEGER,
  USER_VALUE          VARCHAR2(4000 CHAR),
  AUTOMATED_VALUE     VARCHAR2(4000 CHAR),
  ECRF_ITEM_EXTRACT  CLOB,
  USER_VALUE_DATE          DATE,
  AUTOMATED_VALUE_DATE     DATE,
  USER_VALIDATION          INTEGER, 
  USER_VALIDATION_DATE     DATE,
 foreign key (ECRF_ITEM_NUM) references  DWH_ECRF_ITEM (ECRF_ITEM_NUM) on delete cascade
)
TABLESPACE TS_DWH
LOGGING 
MONITORING;


CREATE TABLE DWH_ECRF_SUB_ITEM
(
  ECRF_SUB_ITEM_NUM    INTEGER,
  ECRF_ITEM_NUM        INTEGER,
  SUB_ITEM_LOCAL_STR   VARCHAR2(4000 CHAR),
  SUB_ITEM_LOCAL_CODE  VARCHAR2(4000 CHAR),
  SUB_ITEM_EXT_CODE    VARCHAR2(4000 CHAR),
  SUB_ITEM_REGEXP      VARCHAR2(4000 CHAR),
  PRIMARY KEY
  (ECRF_SUB_ITEM_NUM),
  FOREIGN KEY (ECRF_ITEM_NUM) 
  REFERENCES DWH_ECRF_ITEM (ECRF_ITEM_NUM)
  ON DELETE CASCADE
)
TABLESPACE TS_DWH
LOGGING 
MONITORING;

CREATE TABLE DWH_ECRF_USER_RIGHT
(
  ECRF_NUM  INTEGER,
  USER_NUM  INTEGER,
  RIGHT     VARCHAR2(50 CHAR),
  FOREIGN KEY (ECRF_NUM) 
  REFERENCES DWH_ECRF (ECRF_NUM)
  ON DELETE CASCADE
)
TABLESPACE TS_DWH
LOGGING 
MONITORING;


CREATE TABLE DWH_USER_ECRF
( 
	USER_NUM INT, 
	ECRF_NUM INT, 
	TOKEN_ECRF VARCHAR2 (50) 
) 
TABLESPACE TS_DWH; 


CREATE TABLE DWH_ENRSEM
(
  ENRSEM_NUM               INTEGER,
  DOCUMENT_NUM             INTEGER,
  ENCOUNTER_NUM            VARCHAR2(30 CHAR),
  DOCUMENT_DATE            DATE,
  DOCUMENT_ORIGIN_CODE     VARCHAR2(30 CHAR),
  AGE_PATIENT              FLOAT(126),
  CERTAINTY                INTEGER,
  CONTEXT                  VARCHAR2(50 CHAR),
  THESAURUS_CODE           VARCHAR2(30 CHAR),
  CONCEPT_CODE             VARCHAR2(30 CHAR),
  CONCEPT_STR_FOUND        VARCHAR2(500 CHAR),
  UPDATE_DATE              DATE,
  PATIENT_NUM              INTEGER,
  TFIDF_CODE_DOCUMENT      FLOAT(126),
  COUNT_CONCEPT            INTEGER,
  COUNT_CONCEPT_STR_FOUND  INTEGER,
  UPLOAD_ID                INTEGER
)
TABLESPACE TS_DWH
LOGGING 
MONITORING;



CREATE TABLE DWH_ETL_PROCESS
(
  PROCESS_TYPE   VARCHAR2(50 CHAR),
  COUNT_PROCESS  INTEGER
)
TABLESPACE TS_DWH
LOGGING 
MONITORING;



CREATE TABLE DWH_ETL_SCRIPT
(
  SCRIPT                VARCHAR2(50 CHAR),
  LAST_EXECUTION_DATE   DATE,
  COMMENTARY            VARCHAR2(4000 CHAR),
  COUNT_DOCUMENT        INTEGER,
  DOCUMENT_ORIGIN_CODE  VARCHAR2(50 CHAR),
  UPLOAD_ID             INTEGER
)
TABLESPACE TS_DWH
LOGGING 
MONITORING;


CREATE TABLE DWH_ETL_THESAURUS_ENRSEM
(
  CONCEPT_CODE    VARCHAR2(30 CHAR),
  CONCEPT_STR     VARCHAR2(500 CHAR),
  STR_LENGTH      NUMBER,
  LOAD_DATE       DATE,
  COUNT_DOCUMENT  INTEGER
)
TABLESPACE TS_DWH
LOGGING 
MONITORING;



CREATE TABLE DWH_ETL_THESAURUS_GENE
(
  CONCEPT_CODE    VARCHAR2(30 CHAR),
  CONCEPT_STR     VARCHAR2(500 CHAR),
  STR_LENGTH      NUMBER,
  LOAD_DATE       DATE,
  COUNT_DOCUMENT  INTEGER
)
TABLESPACE TS_DWH
LOGGING 
MONITORING;


CREATE TABLE DWH_EXPORT_DATA
(
  EXPORT_DATA_NUM  NUMBER(38),
  USER_NUM         NUMBER(38),
  TITLE            VARCHAR2(500 CHAR),
  LIST_CONCEPT     VARCHAR2(4000 CHAR),
  CREATION_DATE    DATE,
  SHARE_LIST       VARCHAR2(500 CHAR)
)
TABLESPACE TS_DWH
LOGGING 
MONITORING;



CREATE TABLE DWH_FILE
(
  PATIENT_NUM     INTEGER,
  DOCUMENT_NUM    INTEGER,
  FILE_NUM        INTEGER,
  FILE_TITLE      VARCHAR2(4000 CHAR),
  FILE_ORDER      INTEGER,
  FILE_CONTENT    CLOB,
  FILE_MIME_TYPE  VARCHAR2(20 CHAR),
  UPLOAD_ID       INTEGER,
  PRIMARY KEY
  (FILE_NUM)
)
TABLESPACE TS_DWH
LOGGING 
MONITORING;


CREATE TABLE DWH_INFO_AGGREGATE
(
  TYPE_INFO    VARCHAR2(50 CHAR),
  DETAIL_INFO  VARCHAR2(100 CHAR),
  NB_VALUE     INTEGER
)
TABLESPACE TS_DWH
LOGGING 
MONITORING;



CREATE TABLE DWH_INFO_ENRSEM
(
  COUNT_DISTINCT_PATIENT  INTEGER
)
TABLESPACE TS_DWH
LOGGING 
MONITORING;


CREATE TABLE DWH_INFO_LOAD
(
  COUNT_PATIENT         INTEGER,
  COUNT_DOCUMENT        INTEGER,
  YEAR                  INTEGER,
  DOCUMENT_ORIGIN_CODE  VARCHAR2(40 CHAR),
  MONTH                 INTEGER
)
TABLESPACE TS_DWH
LOGGING 
MONITORING;



CREATE TABLE DWH_LOG_DOCUMENT
(
  DOCUMENT_NUM  INTEGER,
  USER_NUM      INTEGER,
  LOG_DATE      DATE,
  NOMINATIVE    VARCHAR2(10 CHAR)
)
TABLESPACE TS_DWH
LOGGING 
MONITORING;



CREATE TABLE DWH_LOG_PAGE
(
  USER_NUM  INTEGER,
  LOG_DATE  DATE,
  PAGE      VARCHAR2(50 CHAR)
)
TABLESPACE TS_DWH
LOGGING 
MONITORING;



CREATE TABLE DWH_LOG_PATIENT
(
  USER_NUM     INTEGER,
  IPP          VARCHAR2(30 CHAR),
  LOG_DATE     DATE,
  NOMINATIVE   INTEGER,
  LOG_CONTEXT  VARCHAR2(50 CHAR),
  PATIENT_NUM  INTEGER
)
TABLESPACE TS_DWH
LOGGING 
MONITORING;


CREATE TABLE DWH_LOG_QUERY
(
  USER_NUM       INTEGER,
  LOG_DATE       DATE,
  QUERY_CONTEXT  VARCHAR2(50 CHAR),
  XML_QUERY      CLOB
)
TABLESPACE TS_DWH
LOGGING 
MONITORING;


CREATE TABLE DWH_NOTIFICATION
(
  USER_NUM_SENT       INTEGER,
  USER_NUM_RECEIVER   INTEGER,
  NOTIFICATION_TYPE   VARCHAR2(30 CHAR),
  NOTIFICATION_TEXT   VARCHAR2(4000 CHAR),
  SHARED_ELEMENT_NUM  INTEGER,
  NOTIFICATION_DATE   DATE,
  VIEW_DATE           DATE,
  NOTIFICATION_NUM    INTEGER,
  HIDE_RECEIVER       INTEGER
)
TABLESPACE TS_DWH
LOGGING 
MONITORING;


CREATE TABLE DWH_PATIENT
(
  LASTNAME             VARCHAR2(100 CHAR),
  FIRSTNAME            VARCHAR2(40 CHAR),
  BIRTH_DATE           DATE,
  SEX                  VARCHAR2(2 CHAR),
  MAIDEN_NAME          VARCHAR2(81 CHAR),
  IPP_DROP             VARCHAR2(30 CHAR),
  STATUT_DROP          INTEGER,
  RESIDENCE_ADDRESS    VARCHAR2(1000 CHAR),
  PHONE_NUMBER         VARCHAR2(1000 CHAR),
  ZIP_CODE             VARCHAR2(30 CHAR),
  RESIDENCE_CITY       VARCHAR2(200 CHAR),
  DEATH_DATE           DATE,
  RESIDENCE_COUNTRY    VARCHAR2(100 CHAR),
  RESIDENCE_LATITUDE   VARCHAR2(300 CHAR),
  RESIDENCE_LONGITUDE  VARCHAR2(300 CHAR),
  COORDONNEES          MDSYS.SDO_GEOMETRY,
  DEATH_CODE           VARCHAR2(2 CHAR),
  UPDATE_DATE          DATE,
  BIRTH_COUNTRY        VARCHAR2(100 CHAR),
  BIRTH_CITY           VARCHAR2(100 CHAR),
  BIRTH_ZIP_CODE       VARCHAR2(10 CHAR),
  BIRTH_LATITUDE       FLOAT(126),
  BIRTH_LONGITUDE      FLOAT(126),
  PATIENT_NUM          INTEGER,
  UPLOAD_ID            INTEGER,
  UNIQUE (PATIENT_NUM)
)
COLUMN COORDONNEES NOT SUBSTITUTABLE AT ALL LEVELS
TABLESPACE TS_DWH
LOGGING 
MONITORING;



CREATE TABLE DWH_PATIENT_DEPARTMENT
(
  DEPARTMENT_NUM  INTEGER,
  PATIENT_NUM     INTEGER
)
TABLESPACE TS_DWH
LOGGING 
MONITORING;



CREATE TABLE DWH_PATIENT_IPPHIST
(
  PATIENT_NUM          INTEGER,
  HOSPITAL_PATIENT_ID  VARCHAR2(100 CHAR),
  ORIGIN_PATIENT_ID    VARCHAR2(40 CHAR),
  MASTER_PATIENT_ID    INTEGER,
  UPLOAD_ID            INTEGER
)
TABLESPACE TS_DWH
LOGGING 
MONITORING;

CREATE TABLE DWH_PATIENT_MVT
(
  ENCOUNTER_NUM   VARCHAR2(20 CHAR),
  UNIT_CODE       VARCHAR2(10 CHAR),
  ENTRY_DATE      DATE,
  OUT_DATE        DATE,
  DEPARTMENT_NUM  INTEGER,
  UNIT_NUM        INTEGER,
  PATIENT_NUM     INTEGER,
  UPLOAD_ID       INTEGER,
  MVT_NUM         INTEGER,
  MVT_ENTRY_MODE  VARCHAR2(300 CHAR),
  MVT_EXIT_MODE   VARCHAR2(300 CHAR),
  TYPE_MVT        VARCHAR2(30 CHAR),
  ENTRY           INTEGER,
  OUT             INTEGER,
  MVT_ORDER       INTEGER
)
TABLESPACE TS_DWH
LOGGING 
MONITORING;


CREATE TABLE DWH_PATIENT_OPPOSITION
(
  HOSPITAL_PATIENT_ID  VARCHAR2(100 CHAR),
  ORIGIN_PATIENT_ID    VARCHAR2(40 CHAR),
  PATIENT_NUM          INTEGER,
  OPPOSITION_DATE      DATE,
  USER_NUM         INTEGER
)
TABLESPACE TS_DWH
LOGGING 
MONITORING;



CREATE TABLE DWH_PATIENT_REL
(
  PATIENT_NUM_1  INTEGER,
  PATIENT_NUM_2  INTEGER,
  RELATION       VARCHAR2(40 CHAR)
)
TABLESPACE TS_DWH
LOGGING 
MONITORING;



CREATE TABLE DWH_PATIENT_STAT
(
  PATIENT_NUM                  INTEGER,
  COUNT_UNIQUE_CONCEPT         INTEGER,
  COUNT_TOTAL_CONCEPT          INTEGER,
  MIN_DATE_DOC                 DATE,
  MAX_DATE_DOC                 DATE,
  COUNT_DOC                    INTEGER,
  UPDATE_DATE                  DATE,
  COUNT_UNIQUE_CONCEPT_NONNEG  INTEGER
)
TABLESPACE TS_DWH
LOGGING 
MONITORING;



CREATE TABLE DWH_PATIENT_STAY
(
  PATIENT_NUM    INTEGER,
  ENCOUNTER_NUM  VARCHAR2(20 CHAR),
  ENTRY_DATE     DATE,
  OUT_DATE       DATE,
  ENTRY_MODE     VARCHAR2(400 CHAR),
  OUT_MODE       VARCHAR2(500 CHAR),
  TYPE_DOS       VARCHAR2(10 CHAR),
  UPLOAD_ID      INTEGER
)
TABLESPACE TS_DWH
LOGGING 
MONITORING;



CREATE TABLE DWH_PROCESS
(
  PROCESS_NUM       INTEGER,
  STATUS            INTEGER,
  USER_NUM          INTEGER,
  COMMENTARY        VARCHAR2(4000 CHAR),
  RESULT            CLOB,
  PROCESS_END_DATE  DATE,
  CATEGORY_PROCESS  VARCHAR2(4000 CHAR),
  TYPE_RESULT       VARCHAR(30 CHAR)
)
TABLESPACE TS_DWH
LOGGING 
MONITORING;



CREATE TABLE DWH_PROCESS_PATIENT
(
  PROCESS_NUM  INTEGER,
  PATIENT_NUM  INTEGER
)
TABLESPACE TS_DWH
LOGGING 
MONITORING;



CREATE TABLE DWH_PROFILE_DOCUMENT_ORIGIN
(
  USER_PROFILE          VARCHAR2(40 CHAR),
  DOCUMENT_ORIGIN_CODE  VARCHAR2(40 CHAR)
)
TABLESPACE TS_DWH
LOGGING 
MONITORING;



CREATE TABLE DWH_PROFILE_RIGHT
(
  USER_PROFILE  VARCHAR2(40 CHAR),
  RIGHT         VARCHAR2(40 CHAR)
)
TABLESPACE TS_DWH
LOGGING 
MONITORING;



CREATE TABLE DWH_QUERY
(
  QUERY_NUM        NUMBER(38),
  USER_NUM         INTEGER,
  XML_QUERY        CLOB,
  QUERY_DATE       DATE,
  TITLE_QUERY      VARCHAR2(500 CHAR),
  DATAMART_NUM     NUMBER(38),
  QUERY_TYPE       VARCHAR2(30 CHAR),
  CRONTAB_QUERY    INTEGER,
  LAST_LOAD_DATE   DATE,
  CRONTAB_PERIODE  VARCHAR2(20 CHAR),
  PIN              INTEGER,
  CONSTRAINT DWH_REQUETE_PK
  PRIMARY KEY
  (QUERY_NUM)
)
TABLESPACE TS_DWH
LOGGING 
MONITORING;



CREATE TABLE DWH_QUERY_RESULT
(
  LOAD_DATE    DATE,
  QUERY_NUM    INTEGER,
  PATIENT_NUM  INTEGER,
  FOREIGN KEY (QUERY_NUM) 
  REFERENCES DWH_QUERY (QUERY_NUM)
  ON DELETE CASCADE
)
TABLESPACE TS_DWH
LOGGING 
MONITORING;



CREATE TABLE DWH_REQUEST_ACCESS
(
  REQUEST_ACCESS_NUM            INTEGER,
  USER_NUM_REQUEST              INTEGER,
  DEPARTMENT_NUM                INTEGER,
  NUSER_NUM_DEPARTMENT_MANAGER  INTEGER,
  READABLE_QUERY                CLOB,
  REQUEST_ACCESS_DATE           DATE,
  MANAGER_AGREEMENT             INTEGER,
  MANAGER_AGREEMENT_DATE        DATE,
  VIEWED_BY_MANAGER_DATE        DATE,
  VIEWED_BY_MANAGER_OK_DATE     DATE,
  VIEWED_BY_MANAGER_NOTOK_DATE  DATE
)
TABLESPACE TS_DWH
LOGGING 
MONITORING;



CREATE TABLE DWH_REQUEST_ACCESS_PATIENT
(
  REQUEST_ACCESS_NUM  INTEGER,
  PATIENT_NUM         INTEGER
)
TABLESPACE TS_DWH
LOGGING 
MONITORING;



CREATE TABLE DWH_TEXT
(
  DOCUMENT_NUM          INTEGER,
  TEXT                  CLOB,
  CONTEXT               VARCHAR2(200 CHAR),
  ENCOUNTER_NUM         VARCHAR2(30 CHAR),
  CERTAINTY             FLOAT(126),
  DOCUMENT_DATE         DATE,
  DOCUMENT_ORIGIN_CODE  VARCHAR2(30 CHAR),
  TITLE                 VARCHAR2(300 CHAR),
  AUTHOR                VARCHAR2(200 CHAR),
  AGE_PATIENT           FLOAT(126),
  ENRICH_TEXT           CLOB,
  DEPARTMENT_NUM        INTEGER,
  PATIENT_NUM           INTEGER,
  UPLOAD_ID             INTEGER
)
TABLESPACE TS_DWH
LOGGING 
MONITORING;



CREATE TABLE DWH_THESAURUS_CITY
(
  CITY_NAME       VARCHAR2(200 CHAR),
  CITY_NORM_NAME  VARCHAR2(200 CHAR),
  LATITUDE        VARCHAR2(300 CHAR),
  LONGITUDE       VARCHAR2(300 CHAR),
  COORDONNEES     MDSYS.SDO_GEOMETRY,
  ZIP_CODE        VARCHAR2(10 CHAR),
  INSEE_CODE      VARCHAR2(10 CHAR),
  AREA_CODE       VARCHAR2(10 CHAR),
  COUNTRY         VARCHAR2(100 CHAR)
)
COLUMN COORDONNEES NOT SUBSTITUTABLE AT ALL LEVELS
TABLESPACE TS_DWH
LOGGING 
MONITORING;



CREATE TABLE DWH_THESAURUS_CORRORTHO
(
  TERM  VARCHAR2(4000 CHAR)
)
TABLESPACE TS_DWH
LOGGING 
MONITORING;



CREATE TABLE DWH_THESAURUS_COUNTRY
(
  CAPITAL_CITY_CODE         VARCHAR2(4 CHAR),
  CAPITAL_CITY_STR_FR       VARCHAR2(200 CHAR),
  CAPITAL_CITY_STR_EN       VARCHAR2(200 CHAR),
  CAPITAL_CITY_STR_NORM_FR  VARCHAR2(200 CHAR),
  CAPITAL_CITY_CODE_EN      VARCHAR2(10 CHAR),
  CAPITAL_CITY_STR          VARCHAR2(100 CHAR),
  LATITUDE                  VARCHAR2(30 CHAR),
  LONGITUDE                 VARCHAR2(30 CHAR),
  COORDONNEES               VARCHAR2(200 CHAR),
  CAPITAL_CITY_STR_SYN_FR   VARCHAR2(300 CHAR),
  INSEE_CODE                VARCHAR2(6 CHAR)
)
TABLESPACE TS_DWH
LOGGING 
MONITORING;




CREATE TABLE DWH_THESAURUS_DATA
(
  THESAURUS_DATA_NUM    INTEGER,
  THESAURUS_CODE        VARCHAR2(30 CHAR),
  CONCEPT_CODE          VARCHAR2(100 CHAR),
  CONCEPT_STR           VARCHAR2(300 CHAR),
  INFO_COMPLEMENT       VARCHAR2(500 CHAR),
  MEASURING_UNIT        VARCHAR2(30 CHAR),
  VALUE_TYPE            VARCHAR2(50 CHAR),
  LIST_VALUES           VARCHAR2(4000 CHAR),
  THESAURUS_PARENT_NUM  INTEGER,
  DESCRIPTION           VARCHAR2(4000 CHAR),
  COUNT_DATA_USED       INTEGER,
  CONCEPT_PATH          CLOB,
  PRIMARY KEY
  (THESAURUS_DATA_NUM)
)
TABLESPACE TS_DWH
LOGGING 
MONITORING;



CREATE TABLE DWH_THESAURUS_DATA_GRAPH
(
  THESAURUS_DATA_SON_NUM     INTEGER,
  THESAURUS_DATA_FATHER_NUM  INTEGER,
  DISTANCE                   INTEGER,
  THESAURUS_CODE             VARCHAR2(30 CHAR)
)
TABLESPACE TS_DWH
LOGGING 
MONITORING;


CREATE TABLE DWH_THESAURUS_DEPARTMENT
(
  DEPARTMENT_NUM   INTEGER,
  DEPARTMENT_STR   VARCHAR2(400 CHAR),
  DEPARTMENT_CODE  VARCHAR2(5 CHAR),
  PRIMARY KEY
  (DEPARTMENT_NUM)
)
TABLESPACE TS_DWH
LOGGING 
MONITORING;


CREATE TABLE DWH_THESAURUS_ENRSEM
(
  THESAURUS_ENRSEM_NUM       INTEGER,
  THESAURUS_CODE             VARCHAR2(40 CHAR),
  THESAURUS_STR              VARCHAR2(40 CHAR),
  PATH_CODE                  VARCHAR2(4000 CHAR),
  PATH_STR                   VARCHAR2(4000 CHAR),
  CONCEPT_CODE               VARCHAR2(30 CHAR),
  CONCEPT_STR                VARCHAR2(500 CHAR),
  NIVEAU                     INTEGER,
  ADD_DATE                   DATE,
  COUNT_DOC_CONCEPT_STR      INTEGER,
  PREF                       VARCHAR2(1 CHAR),
  COUNT_PATIENT_SUBSUMPTION  INTEGER,
  COUNT_PATIENT              INTEGER,
  GENOTYPE                   INTEGER,
  PHENOTYPE                  INTEGER,
  CONCEPT_STR_EN             VARCHAR2(500 CHAR)
)
TABLESPACE TS_DWH
LOGGING 
MONITORING;


CREATE TABLE DWH_THESAURUS_ENRSEM_GRAPH
(
  CONCEPT_CODE_FATHER  VARCHAR2(30 CHAR),
  CONCEPT_CODE_SON     VARCHAR2(30 CHAR),
  DISTANCE             INTEGER
)
TABLESPACE TS_DWH
LOGGING 
MONITORING;


CREATE TABLE DWH_THESAURUS_PUBMED_GENE
(
  TAX_ID                   INTEGER,
  GENEID                   INTEGER,
  SYMBOL                   VARCHAR2(50 CHAR),
  LOCUSTAG                 VARCHAR2(100 CHAR),
  SYNONYMS                 VARCHAR2(300 CHAR),
  DBXREFS                  VARCHAR2(300 CHAR),
  CHROMOSOME               VARCHAR2(30 CHAR),
  MAP_LOCATION             VARCHAR2(100 CHAR),
  DESCRIPTION              VARCHAR2(300 CHAR),
  TYPE_OF_GENE             VARCHAR2(30 CHAR),
  SYMBOL_FROM_NOM_AUTH     VARCHAR2(50 CHAR),
  FULL_NAME_FROM_NOM_AUTH  VARCHAR2(1000 CHAR),
  NOMENCLATURE_STATUS      VARCHAR2(2 CHAR),
  OTHER_DESIGNATIONS       VARCHAR2(4000 CHAR),
  MODIFICATION_DATE        DATE,
  CUI                      VARCHAR2(40 CHAR)
)
TABLESPACE TS_DWH
LOGGING 
MONITORING;



CREATE TABLE DWH_THESAURUS_PUBMED_GENE2GO
(
  TAX_ID     INTEGER,
  GENEID     INTEGER,
  GO_ID      VARCHAR2(20 CHAR),
  EVIDENCE   VARCHAR2(5 CHAR),
  QUALIFIER  VARCHAR2(50 CHAR),
  GO_TERM    VARCHAR2(300 CHAR),
  CATEGORY   VARCHAR2(20 CHAR),
  PUBMED     CLOB
)
TABLESPACE TS_DWH
LOGGING 
MONITORING;



CREATE TABLE DWH_THESAURUS_TAL
(
  THESAURUS_TAL_NUM  INTEGER,
  THESAURUS_CODE     VARCHAR2(40 CHAR),
  THESAURUS_STR      VARCHAR2(40 CHAR),
  PATH_CODE          VARCHAR2(4000 CHAR),
  PATH_STR           VARCHAR2(4000 CHAR),
  CONCEPT_CODE       VARCHAR2(30 CHAR),
  CONCEPT_STR        VARCHAR2(500 CHAR),
  NIVEAU             INTEGER,
  ADD_DATE           DATE,
  EXCLUDED           INTEGER,
  NEW_CODE_STR       INTEGER,
  ADD_MODE           VARCHAR2(30 CHAR),
  EXCLUSION_DATE     DATE
)
TABLESPACE TS_DWH
LOGGING 
MONITORING;



CREATE TABLE DWH_THESAURUS_TAL_CHEMIN
(
  CONCEPT_CODE       VARCHAR2(30 CHAR),
  CONCEPT_CODE_PATH  VARCHAR2(4000 CHAR)
)
TABLESPACE TS_DWH
LOGGING 
MONITORING;



CREATE TABLE DWH_THESAURUS_TYPESEMANTIC
(
  CONCEPT_CODE   VARCHAR2(30 CHAR),
  SEMANTIC_TYPE  VARCHAR2(400 CHAR)
)
TABLESPACE TS_DWH
LOGGING 
MONITORING;



CREATE TABLE DWH_THESAURUS_UNIT
(
  UNIT_NUM         INTEGER,
  UNIT_CODE        VARCHAR2(30 CHAR),
  UNIT_STR         VARCHAR2(400 CHAR),
  DEPARTMENT_NUM   INTEGER,
  UNIT_START_DATE  DATE,
  UNIT_END_DATE    DATE,
  FOREIGN KEY (DEPARTMENT_NUM) 
  REFERENCES DWH_THESAURUS_DEPARTMENT (DEPARTMENT_NUM)
  ON DELETE CASCADE
)
TABLESPACE TS_DWH
LOGGING 
MONITORING;



CREATE TABLE DWH_TMP_PRERESULT
(
  DOCUMENT_NUM          INTEGER,
  QUERY_KEY             VARCHAR2(4000 CHAR),
  TMPRESULT_DATE        DATE,
  USER_NUM              INTEGER,
  DATAMART_NUM          INTEGER,
  DOCUMENT_ORIGIN_CODE  VARCHAR2(50 CHAR),
  PATIENT_NUM           INTEGER,
  DOCUMENT_DATE         DATE
)
TABLESPACE TS_DWH
CACHE
MONITORING;



CREATE TABLE DWH_TMP_QUERY
(
  QUERY_KEY         VARCHAR2(4000 CHAR),
  SQL               VARCHAR2(4000 CHAR),
  DATAMART_NUM      INTEGER,
  USER_NUM          INTEGER,
  STATUS_CALCULATE  INTEGER,
  QUERY_DATE        DATE,
  COUNT_PATIENT     INTEGER,
  SQL_CLOB          CLOB
)
TABLESPACE TS_DWH
LOGGING 
MONITORING;



CREATE TABLE DWH_TMP_RESULT
(
  TMPRESULT_NUM         NUMBER(38),
  USER_NUM              VARCHAR2(30 CHAR),
  ENCOUNTER_NUM         VARCHAR2(20 CHAR),
  DOCUMENT_NUM          NUMBER(38),
  DOCUMENT_DATE         DATE,
  AUTHOR                VARCHAR2(80 CHAR),
  DOCUMENT_ORIGIN_CODE  VARCHAR2(30 CHAR),
  TITLE                 VARCHAR2(300 CHAR),
  DEPARTMENT_NUM        INTEGER,
  PATIENT_NUM           INTEGER
)
TABLESPACE TS_DWH
CACHE
MONITORING;


CREATE TABLE DWH_TOOL
(
  TOOL_NUM     INTEGER,
  TITLE        VARCHAR2(100 CHAR),
  AUTHORS      VARCHAR2(100 CHAR),
  DESCRIPTION  VARCHAR2(4000 CHAR),
  URL          VARCHAR2(300 CHAR)
)
TABLESPACE TS_DWH
LOGGING 
MONITORING;



CREATE TABLE DWH_USER
(
  USER_NUM           INTEGER,
  FIRSTNAME          VARCHAR2(30 CHAR),
  LASTNAME           VARCHAR2(30 CHAR),
  LOGIN              VARCHAR2(30 CHAR),
  MAIL               VARCHAR2(100 CHAR),
  PASSWD             VARCHAR2(200 CHAR),
  USER_PHONE_NUMBER  VARCHAR2(50 CHAR),
  COUNT_ATTEMPT      INTEGER,
  ATTEMPT_DATE       DATE,
  CREATION_DATE      DATE,
  EXPIRATION_DATE    DATE,
  PRIMARY KEY
  (USER_NUM)
)
TABLESPACE TS_DWH
LOGGING 
MONITORING;



CREATE TABLE DWH_USER_CONNEXION
(
  LOGIN             VARCHAR2(30 CHAR),
  LAST_UPDATE_DATE  DATE,
  DATABASE          VARCHAR2(30 CHAR),
  USER_NAME         VARCHAR2(100 CHAR)
)
TABLESPACE TS_DWH
LOGGING 
MONITORING;



CREATE TABLE DWH_USER_DEPARTMENT
(
  USER_NUM            INTEGER,
  DEPARTMENT_NUM      INTEGER,
  MANAGER_DEPARTMENT  INTEGER,
  FOREIGN KEY (DEPARTMENT_NUM) 
  REFERENCES DWH_THESAURUS_DEPARTMENT (DEPARTMENT_NUM)
  ON DELETE CASCADE,
  FOREIGN KEY (USER_NUM) 
  REFERENCES DWH_USER (USER_NUM)
  ON DELETE CASCADE
)
TABLESPACE TS_DWH
LOGGING 
MONITORING;



CREATE TABLE DWH_USER_ONLINE
(
  USER_NUM          VARCHAR2(30 CHAR),
  LAST_UPDATE_DATE  DATE,
  DATABASE          VARCHAR2(30 CHAR),
  USER_NAME         VARCHAR2(100 CHAR)
)
TABLESPACE TS_DWH
LOGGING 
MONITORING;

CREATE TABLE DWH_USER_PROFILE
(
  USER_PROFILE  VARCHAR2(30 CHAR),
  USER_NUM      INTEGER
)
TABLESPACE TS_DWH
LOGGING 
MONITORING;

CREATE TABLE DWH_REGEXP (
	REGEXP_NUM INT,
	TITLE VARCHAR(4000 CHAR),
	DESCRIPTION VARCHAR(4000 CHAR),
	REGEXP VARCHAR(4000 CHAR),
	USER_NUM_CREATION INT,
	CREATION_DATE DATE,
	SHARED INT)
TABLESPACE TS_DWH
LOGGING 
MONITORING;

create table DWH_ADMIN_CGU 
	(cgu_num int, cgu_text clob,cgu_date date,published int,published_date date,unpublished_date date, primary key (cgu_num)) 
TABLESPACE TS_DWH
LOGGING 
MONITORING;

create table DWH_ADMIN_CGU_USER (cgu_num int, user_num int,date_signature date, foreign key (cgu_num) references DWH_ADMIN_CGU (cgu_num) on delete cascade) 
TABLESPACE TS_DWH
LOGGING 
MONITORING;